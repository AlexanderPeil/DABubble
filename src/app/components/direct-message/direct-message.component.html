<div class="chatHistoryMainContainer">
    <div class="chatHistoryHeader">
        <div class="userName" (click)="openDialog()">
            <div class="userIconWrapper">
                <img class="userImg" [src]="messageService.selectedUser?.photoURL" alt="">
                <img *ngIf="messageService.selectedUser?.isOnline" class="statusIcon"
                    src="../../../assets/img/icons/user_online.svg" alt="Online" />
                <img *ngIf="messageService.selectedUser?.isOnline" class="statusIcon"
                    src="../../../assets/img/icons/user_offline.svg" alt="Offline" />
            </div>
            <p>{{ messageService.selectedUser?.displayName }}</p>
        </div>
    </div>

    <div *ngIf="!groupedMessages.length" class="emptyChatDiv">
        <img class="userImgEmptyChat" [src]="messageService.selectedUser?.photoURL" alt="Receiver Image" />
        <p>This chat is only between <span>@{{messageService.selectedUser?.displayName}}</span> and you.</p>
    </div>


    <!-- Message container -->
    <div #messagesContainer class="messageMainContainer scrolleableContainer">
        <div *ngFor="let group of groupedMessages" class="messageContainer">
            <div class="date">
                <hr>
                <span>{{ group.date }}</span>
                <hr>
            </div>
            <div *ngFor="let message of group.messages" class="displayMessagesContainer"
                (mouseenter)="onMessageHover(message)" (mouseleave)="message.id ? handleMouseLeave(message.id) : null">
                <div class="messageChildContainer">
                    <img class="userImg" [src]="message.senderImage">
                    <div class="containerUserNameAndTime">
                        <div class="nameTimeContainer">
                            <p>{{ message.senderName }}</p>
                            <p>{{ this.messageService.formatTime(message.timestamp) }}</p>
                        </div>
                        <span *ngIf="isEditing !== message.id" class="message"
                            [ngClass]="{'senderMessage': message.senderId === authService.currentUser.value?.uid}">
                            {{
                            message.content }}</span>
                        <div *ngIf="currentlyEditingMessageId === message.id && isEditing === message.id"
                            class="editMessageContainer">
                            <input [(ngModel)]="updatedMessageContent">
                            <img class="sendBtn" src="assets/img/icons/sendBtn.svg"
                                (click)="saveEditedMessage(message)">
                        </div>
                    </div>

                    <div *ngIf="emojiPopUpIsOopen" class="containerPopUp">
                        <img src="assets/img/icons/completeEmoji.svg">
                        <img src="assets/img/icons/handsUpEmoji.svg">
                        <img src="assets/img/icons/rocket.svg">
                        <img src="assets/img/icons/nerdSmiley.svg">
                    </div>

                    <!-- Emoji container -->
                    <div class="containerEmojis d-none">
                        <img (click)="setCheckedIcon()" class="completeEmoji"
                            src="assets/img/icons/completeEmoji.svg" />
                        <img (click)="setHandsUpIcon()" class="handsUpEmoji" src="assets/img/icons/handsUpEmoji.svg" />
                        <div #popUp (click)="openEmojiPopUp()" class="containerAddEmojiIcon">
                            <img class="addEmojiIcon" src="assets/img/icons/addEmojiIcon.svg" />
                        </div>
                        <div (click)="messageService.selectedUser && messageService.selectedUser.uid
                        && message.id && threadService.openDirectMessageThread(message.id, messageService.selectedUser.uid)"
                            class="containerAnswerOnThreadIcon">
                            <img class="answerOnThreadIcon" src="assets/img/icons/answerOnThreadIcon.svg">
                        </div>
                        <div *ngIf="showEditMessageButton" (click)="openPopUpEditMessage(message)"
                            class="containerThreePointsIcon">
                            <img src="assets/img/icons/threePointsIcon.svg">
                        </div>
                    </div>
                    <!-- Emoji container -->

                    <!-- Pop Up to Edit Message -->
                    <div *ngIf="currentlyEditingMessageId === message.id" class="popUpEditMessage"
                        (mouseover)="stopEvent($event)" (click)="editMessage(message.id, message.content)">
                        <p>Edit message</p>
                    </div>
                    <!-- Pop Up to Edit Message -->

                    <!-- Emojis to react on Messages -->
                    <div *ngIf="displayCheckedIcon" class="containerCheckIcon">
                        <img src="assets/img/icons/completeEmoji.svg">
                        <p>1</p>
                    </div>

                    <div *ngIf="displayHandsUpIcon" class="containerHandsUpIcon">
                        <img src="assets/img/icons/handsUpEmoji.svg">
                        <p>1</p>
                    </div>
                    <!-- Emojis to react on Messages -->
                </div>
            </div>
        </div>

        <!-- Message container -->

        <quill-editor [(ngModel)]="messageContent" placeholder="Write a message"
            (onEditorCreated)="this.quillService.setFocus($event)" [modules]="this.quillService.quillModules">
            <div quill-editor-toolbar>

                <!--------------------------------------- Custom created Container --------------------------------------->
                <div class="mainContainerUploadedDatas">
                    <!--------------------------------------- Displays uploaded Images --------------------------------------->
                    <div *ngFor="let uploadedImage of storageService?.uploadedImages; let i = index"
                        class="containerUploadedImages">
                        <img class="uploadedImage" [src]="uploadedImage ? uploadedImage : null">
                        <img matTooltipPosition="above" matTooltip="Delete Data"
                            (click)="this.storageService.deleteUploadedDataService(uploadedImage, i)" class="closeIcon"
                            src="assets/img/icons/closeIcon.svg">
                    </div>
                    <!--------------------------------------- Displays uploaded Images --------------------------------------->


                    <!--------------------------------------- Displays uploaded Datas, like PDF --------------------------------------->
                    <div *ngFor="let uploadedData of storageService.uploadedDatas; let i = index"
                        class="containerUploadedDatas">
                        <iframe class="uploadedData" [src]="uploadedData ? uploadedData : null"></iframe>
                        <img matTooltipPosition="above" matTooltip="Delete Data"
                            (click)="this.storageService.deleteUploadedDataService(uploadedData, i)" class="closeIcon"
                            src="assets/img/icons/closeIcon.svg">
                    </div>
                    <!--------------------------------------- Displays uploaded Datas, like PDF --------------------------------------->
                </div>

                <div class="containerIcons">
                    <label for="input" class="containerAddIcon">
                        <img src="assets/img/icons/add.svg" />
                        <input (change)="chooseFiletoUpload($event)" id="input" type="file" hidden />
                    </label>

                    <hr class="verticalLine" />

                    <div class="containerSmileyIcon">
                        <img class="smileyIcon" src="assets/img/icons/smiley.svg" (click)="toggleEmojiPicker()" />
                    </div>

                    <div class="containerAtIcon">
                        <img class="atIcon" src="assets/img/icons/@Icon.svg"
                            (click)="this.quillService.triggerAtSymbol()" />
                    </div>
                    <img (click)="sendMessage()" class="sendBtn" src="assets/img/icons/sendBtn.svg" />
                </div>
                <!--------------------------------------- Custom created Container --------------------------------------->

            </div>
        </quill-editor>
        <!-- Message textarea -->
    </div>